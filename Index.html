<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>El Impostor</title>
</head>
<body>
  <h1>Juego: El Impostor ğŸ”¥</h1>
  <p id="estado">Conectado a Firebase âœ…</p>

  <!-- Formulario para ingresar nombre -->
  <h2>Ingresa tu nombre:</h2>
  <input type="text" id="nombreJugador" placeholder="Escribe tu nombre">
  <button onclick="registrarJugador()">Unirme</button>

  <h3>Jugadores conectados:</h3>
  <ul id="listaJugadores"></ul>

  <!-- BotÃ³n para que el anfitriÃ³n asigne roles -->
  <button onclick="asignarRoles()">ğŸ² Asignar roles</button>

  <!-- AquÃ­ cada jugador verÃ¡ su rol -->
  <h2>Tu rol:</h2>
  <p id="miRol">AÃºn no asignado</p>

  <!-- Importar Firebase desde CDN -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set, push, onValue, get, update } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // ConfiguraciÃ³n Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyB0uGD9OPVzPEZLBokRiCAlhvyJ9oaxF2Y",
      authDomain: "el-impostor-801.firebaseapp.com",
      databaseURL: "https://el-impostor-801-default-rtdb.firebaseio.com/",
      projectId: "el-impostor-801",
      storageBucket: "el-impostor-801.firebasestorage.app",
      messagingSenderId: "409123127795",
      appId: "1:409123127795:web:a0c7c2e421bbdc197b9286",
      measurementId: "G-43PKD2H5QM"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Guardar el ID del jugador actual
    let miId = null;

    // Lista de 50 famosos
    const famosos = [
      "Messi", "Cristiano Ronaldo", "Shakira", "Bad Bunny", "Taylor Swift",
      "Michael Jackson", "BeyoncÃ©", "Elon Musk", "Albert Einstein", "NapoleÃ³n",
      "Leonardo da Vinci", "Frida Kahlo", "Maluma", "Karol G", "Selena Gomez",
      "Brad Pitt", "Angelina Jolie", "Tom Cruise", "Keanu Reeves", "Lady Gaga",
      "Rihanna", "Kanye West", "Dua Lipa", "Adele", "Jennifer Lopez",
      "Will Smith", "Dwayne Johnson", "Robert Downey Jr.", "Scarlett Johansson", "Chris Hemsworth",
      "Megan Fox", "Zendaya", "Emma Watson", "Daniel Radcliffe", "Hugh Jackman",
      "Barack Obama", "Donald Trump", "Lionel Richie", "Katy Perry", "Mick Jagger",
      "Paul McCartney", "Ozuna", "Daddy Yankee", "Don Omar", "Marc Anthony",
      "J Balvin", "Anuel AA", "Bill Gates", "Steve Jobs", "Oprah Winfrey"
    ];

    // FunciÃ³n para registrar jugadores
    window.registrarJugador = function() {
      const nombre = document.getElementById("nombreJugador").value.trim();
      if (nombre === "") {
        alert("Por favor escribe tu nombre");
        return;
      }

      const jugadoresRef = ref(db, "jugadores");
      const nuevoJugadorRef = push(jugadoresRef);
      miId = nuevoJugadorRef.key;

      set(nuevoJugadorRef, {
        nombre: nombre,
        rol: "AÃºn no asignado"
      });

      document.getElementById("nombreJugador").value = "";
    }

    // Escuchar cambios en la lista de jugadores
    const jugadoresRef = ref(db, "jugadores");
    onValue(jugadoresRef, (snapshot) => {
      const lista = document.getElementById("listaJugadores");
      lista.innerHTML = "";

      snapshot.forEach((childSnapshot) => {
        const jugador = childSnapshot.val();
        const li = document.createElement("li");
        li.textContent = jugador.nombre + " - " + jugador.rol;
        lista.appendChild(li);

        // Mostrar mi rol en mi pantalla
        if (childSnapshot.key === miId) {
          document.getElementById("miRol").innerText = jugador.rol;
        }
      });
    });

    // FunciÃ³n del anfitriÃ³n para asignar roles
    window.asignarRoles = async function() {
      const snapshot = await get(jugadoresRef);
      if (!snapshot.exists()) return;

      const jugadores = [];
      snapshot.forEach((child) => {
        jugadores.push({ id: child.key, nombre: child.val().nombre });
      });

      if (jugadores.length < 4) {
        alert("âš ï¸ Necesitas al menos 4 jugadores para asignar roles.");
        return;
      }

      // Elegir famoso al azar de la lista
      const famoso = famosos[Math.floor(Math.random() * famosos.length)];

      // Elegir impostor al azar
      const impostorIndex = Math.floor(Math.random() * jugadores.length);
      const updates = {};

      jugadores.forEach((jugador, index) => {
        if (index === impostorIndex) {
          updates[`jugadores/${jugador.id}/rol`] = "Impostor ğŸ•µï¸";
        } else {
          updates[`jugadores/${jugador.id}/rol`] = famoso;
        }
      });

      await update(ref(db), updates);
    }
  </script>
</body>
</html>
